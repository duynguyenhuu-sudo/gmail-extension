<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>GITS Mailer Pro</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { 
      font-family: "Meiryo", "Hiragino Kaku Gothic ProN", sans-serif;
      width: 900px; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #333; line-height: 1.5;
    }
    .container { background: white; padding: 20px; }
    h1 { 
      font-size: 22px; margin: 0 0 15px; text-align: center;
      background: linear-gradient(135deg, #667eea, #764ba2);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }
    .tabs { display: flex; border-bottom: 2px solid #e8ecf4; margin-bottom: 15px; }
    .tab { 
      padding: 10px 20px; cursor: pointer; font-weight: 600; color: #7f8c8d;
      border-bottom: 3px solid transparent; transition: all 0.3s;
    }
    .tab:hover { color: #667eea; }
    .tab.active { color: #667eea; border-bottom-color: #667eea; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    fieldset { 
      border: 2px solid #e8ecf4; border-radius: 10px; 
      padding: 15px; margin-bottom: 15px; background: #fafbfc;
    }
    fieldset:hover { border-color: #667eea; }
    legend { 
      padding: 0 10px; font-weight: 600; color: #2c3e50; font-size: 13px;
      background: white; border-radius: 15px; border: 2px solid #e8ecf4;
    }
    label { display: block; margin: 8px 0 4px; font-weight: 600; color: #34495e; font-size: 12px; }
    input[type="text"], input[type="number"], textarea, select { 
      width: 100%; padding: 10px 12px; border: 2px solid #e8ecf4;
      border-radius: 6px; font-size: 13px; transition: all 0.3s;
    }
    input:focus, textarea:focus, select:focus { outline: none; border-color: #667eea; }
    textarea { min-height: 120px; resize: vertical; font-family: monospace; }
    .file-input-wrapper { position: relative; margin: 6px 0; }
    .file-input-wrapper input[type="file"] { position: absolute; opacity: 0; width: 100%; height: 100%; cursor: pointer; }
    .file-input-label {
      display: block; padding: 10px 16px; background: linear-gradient(135deg, #667eea, #764ba2);
      color: white; border-radius: 6px; text-align: center; cursor: pointer; font-weight: 500; font-size: 12px;
    }
    .file-input-label:hover { transform: translateY(-1px); box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3); }
    .file-input-label.attach { background: linear-gradient(135deg, #f093fb, #f5576c); }
    .row { display: flex; gap: 10px; align-items: flex-start; }
    .row > * { flex: 1; }
    button { 
      padding: 10px 18px; border: none; border-radius: 6px;
      font-weight: 600; cursor: pointer; font-size: 13px; transition: all 0.3s;
    }
    button:hover { transform: translateY(-1px); box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
    button:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
    .btn-primary { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
    .btn-success { background: linear-gradient(135deg, #43e97b, #38f9d7); color: white; }
    .btn-warning { background: linear-gradient(135deg, #fa709a, #fee140); color: white; }
    .btn-info { background: linear-gradient(135deg, #4facfe, #00f2fe); color: white; }
    .small { font-size: 11px; color: #7f8c8d; }
    .list { 
      max-height: 100px; overflow: auto; border: 2px dashed #e8ecf4; 
      padding: 10px; border-radius: 6px; background: white; font-size: 12px;
    }
    .muted { color: #95a5a6; font-style: italic; }
    .err { color: #e74c3c; background: #fdf2f2; padding: 6px 10px; border-radius: 4px; border-left: 3px solid #e74c3c; margin: 6px 0; }
    .ok { color: #27ae60; background: #f0f9f4; padding: 6px 10px; border-radius: 4px; border-left: 3px solid #27ae60; margin: 6px 0; }
    .warn { color: #f39c12; background: #fef9e7; padding: 6px 10px; border-radius: 4px; border-left: 3px solid #f39c12; margin: 6px 0; }
    .pill { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 2px 8px; border-radius: 12px; font-size: 10px; margin: 0 2px; display: inline-block; }
    .info-box { background: linear-gradient(135deg, #e3f2fd, #f3e5f5); border: 1px solid #e1bee7; border-radius: 6px; padding: 10px; margin: 6px 0; font-size: 11px; color: #4a148c; }
    .stats-box {
      background: linear-gradient(135deg, #fff3e0, #ffe0b2); border: 1px solid #ffcc80;
      border-radius: 6px; padding: 10px; margin: 6px 0; font-size: 12px; color: #e65100;
      display: flex; justify-content: space-between; align-items: center;
    }
    .stats-box .count { font-size: 18px; font-weight: bold; }
</style>
</head>
<body>
  <div class="container">
    <h1>ğŸš€ GITS Mailer Pro</h1>
    
    <!-- Daily Stats -->
    <div class="stats-box">
      <div>ğŸ“§ HÃ´m nay: <span class="count" id="dailyCount">0</span>/100 | Queue: <span id="queueCount">0</span></div>
      <div id="limitWarning" style="color: #c62828; display: none;">âš ï¸ Äáº¡t giá»›i háº¡n!</div>
    </div>

    <!-- Tabs -->
    <div class="tabs">
      <div class="tab active" data-tab="import">1. Import Data</div>
      <div class="tab" data-tab="preview">2. Preview</div>
      <div class="tab" data-tab="send">3. Send</div>
      <div class="tab" data-tab="logs">4. Logs</div>
    </div>

    <!-- Tab 1: Import Data -->
    <div id="tab-import" class="tab-content active">
      <fieldset>
        <legend>ğŸ“ File 1: Company Insight (Danh sÃ¡ch KH)</legend>
        <div class="info-box">
          Cá»™t: <span class="pill">Company_Name</span> <span class="pill">Customer_Name</span> 
          <span class="pill">Email</span> <span class="pill">Customer_Domain</span><br>
          Domain codes: A=App/IoT, M=Manufacturing, H=Healthcare, L=Logistic, E=E-commerce, B=Bank, C=Construction, W=Web
        </div>
        <div class="file-input-wrapper">
          <input id="fileCustomer" type="file" accept=".xlsx,.xls,.csv" />
          <label for="fileCustomer" class="file-input-label">ğŸ“Š Chá»n file Company Insight</label>
        </div>
        <div id="customerPreview" class="list muted" style="margin-top:8px;">ChÆ°a cÃ³ dá»¯ liá»‡u.</div>
        <div id="customerValidation" class="small"></div>
      </fieldset>

      <fieldset>
        <legend>ğŸ“ File 2: Domain Master</legend>
        <div class="info-box">
          Cá»™t: <span class="pill">Domain</span> <span class="pill">Title_Mail</span> 
          <span class="pill">CaseStudy_1</span>...<span class="pill">CaseStudy_X</span>
        </div>
        <div class="file-input-wrapper">
          <input id="fileDomain" type="file" accept=".xlsx,.xls,.csv" />
          <label for="fileDomain" class="file-input-label">ğŸ“Š Chá»n file Domain Master</label>
        </div>
        <div id="domainPreview" class="list muted" style="margin-top:8px;">ChÆ°a cÃ³ dá»¯ liá»‡u.</div>
      </fieldset>

      <fieldset>
        <legend>ğŸ“ File 3: Mail Template</legend>
        <div class="file-input-wrapper">
          <input id="fileTemplate" type="file" accept=".txt,.html,.docx" />
          <label for="fileTemplate" class="file-input-label">ğŸ“„ Chá»n file Template (Word/TXT)</label>
        </div>
        <label>Ná»™i dung Template:</label>
        <textarea id="bodyTemplate" placeholder="Email template..."></textarea>
        <div class="small">
          Placeholders: <span class="pill">{{Company_Name}}</span> <span class="pill">{{Customer_Name}}</span> 
          <span class="pill">{{Title_Mail}}</span> <span class="pill">{{CaseStudy_List}}</span><br>
          Hoáº·c: <span class="pill">{{CaseStudy_1}}</span> <span class="pill">{{CaseStudy_2}}</span> ... <span class="pill">{{READ_Casestudy_1}}</span>
        </div>
      </fieldset>

      <fieldset>
        <legend>ğŸ“ Attachments (Max 3 files, 25MB)</legend>
        <div class="file-input-wrapper">
          <input id="fileAttach" type="file" multiple />
          <label for="fileAttach" class="file-input-label attach">ğŸ“ Chá»n file Ä‘Ã­nh kÃ¨m</label>
        </div>
        <div id="attachInfo" class="small muted">0 file.</div>
        <div id="attachedFiles"></div>
      </fieldset>

      <button id="btnValidate" class="btn-primary" style="width:100%;">âœ… Validate & Load Data</button>
      <div id="validateStatus" class="small" style="margin-top:10px;"></div>
    </div>

    <!-- Tab 2: Preview -->
    <div id="tab-preview" class="tab-content">
      <fieldset>
        <legend>ğŸ‘ï¸ Email Preview</legend>
        <div class="row">
          <div>
            <label>Chá»n khÃ¡ch hÃ ng Ä‘á»ƒ preview:</label>
            <select id="previewCustomer" style="margin-bottom:10px;">
              <option value="">-- Chá»n khÃ¡ch hÃ ng --</option>
            </select>
          </div>
          <div>
            <label>Domain:</label>
            <input type="text" id="previewDomain" readonly style="background:#f5f5f5;" />
          </div>
        </div>
        
        <div style="background:#f8f9fa; border-radius:8px; padding:15px; margin-top:10px;">
          <label>ğŸ“§ Subject:</label>
          <div id="previewSubject" style="background:white; padding:10px; border-radius:4px; border:1px solid #ddd; margin-bottom:10px; font-weight:600;"></div>
          
          <label>ğŸ“ Body:</label>
          <div id="previewBody" style="background:white; padding:15px; border-radius:4px; border:1px solid #ddd; white-space:pre-wrap; font-size:13px; max-height:300px; overflow-y:auto;"></div>
        </div>

        <div class="info-box" style="margin-top:10px;">
          <strong>CaseStudy Logic:</strong><br>
          â€¢ 1 Domain â†’ 4 CaseStudy<br>
          â€¢ 2+ Domains â†’ 2 CaseStudy má»—i domain<br>
          â€¢ Tá»± Ä‘á»™ng thÃªm "ãªã©" cuá»‘i danh sÃ¡ch
        </div>
      </fieldset>

      <fieldset>
        <legend>ğŸ“‹ Danh sÃ¡ch khÃ¡ch hÃ ng sáº½ gá»­i</legend>
        <div id="customerList" class="list" style="max-height:150px;"></div>
        <div class="small" style="margin-top:5px;">
          Tá»•ng: <strong id="totalCustomers">0</strong> khÃ¡ch hÃ ng
        </div>
      </fieldset>

      <button id="btnConfirmPreview" class="btn-success" style="width:100%;">âœ… XÃ¡c nháº­n & Chuyá»ƒn sang Send</button>
    </div>

    <!-- Tab 3: Send -->
    <div id="tab-send" class="tab-content">
      <fieldset>
        <legend>ğŸ” Authentication</legend>
        <button id="btnAuth" class="btn-info" style="width:100%;">ğŸ” ÄÄƒng nháº­p Google</button>
        <div id="authStatus" class="small" style="margin-top:5px;"></div>
      </fieldset>

      <fieldset>
        <legend>â±ï¸ Email Delay Settings</legend>
        <div class="row">
          <div>
            <label>Delay Mode:</label>
            <select id="delayMode">
              <option value="random">Random (khuyáº¿n nghá»‹)</option>
              <option value="fixed">Cá»‘ Ä‘á»‹nh</option>
            </select>
          </div>
          <div id="randomDelayWrapper">
            <label>Random tá»« (giÃ¢y):</label>
            <div class="row">
              <input type="number" id="delayMin" value="15" min="5" />
              <span style="padding:10px;">Ä‘áº¿n</span>
              <input type="number" id="delayMax" value="45" min="10" />
            </div>
          </div>
          <div id="fixedDelayWrapper" style="display:none;">
            <label>Delay cá»‘ Ä‘á»‹nh (giÃ¢y):</label>
            <input type="number" id="fixedDelay" value="20" min="5" />
          </div>
        </div>
      </fieldset>

      <fieldset>
        <legend>ğŸ“¤ Send Control</legend>
        <div class="row">
          <button id="btnSendNow" class="btn-success" style="flex:2;">ğŸ“§ Send Now</button>
          <button id="btnStopWorker" class="btn-warning">â¹ï¸ Stop</button>
        </div>
        <div class="small" style="margin-top:8px; color:#7f8c8d;">
          Hoáº·c gá»­i theo queue (cháº¡y ná»n):
        </div>
        <div class="row" style="margin-top:5px;">
          <button id="btnAddToQueue" class="btn-info">ğŸ“¥ Add to Queue</button>
          <button id="btnStartWorker" class="btn-primary">â–¶ï¸ Start Queue</button>
        </div>
        <div id="sendStatus" class="small" style="margin-top:10px;"></div>
        
        <div style="margin-top:10px;">
          <label>Progress:</label>
          <div style="background:#e8ecf4; border-radius:4px; height:20px; overflow:hidden;">
            <div id="progressBar" style="background:linear-gradient(135deg, #667eea, #764ba2); height:100%; width:0%; transition:width 0.3s;"></div>
          </div>
          <div class="small" style="margin-top:5px;">
            <span id="progressText">0/0</span> | Next in: <span id="nextSendIn">--</span>s
          </div>
        </div>
      </fieldset>

      <fieldset>
        <legend>ğŸ“œ Live Log</legend>
        <div id="liveLog" style="background:#1e1e1e; color:#0f0; padding:10px; border-radius:6px; font-family:monospace; font-size:11px; max-height:150px; overflow-y:auto;"></div>
      </fieldset>
    </div>

    <!-- Tab 4: Logs -->
    <div id="tab-logs" class="tab-content">
      <fieldset>
        <legend>ğŸ“Š Send Logs</legend>
        <div class="row" style="margin-bottom:10px;">
          <div>
            <label>Filter by Date:</label>
            <input type="date" id="logDate" />
          </div>
          <div>
            <label>Filter by Status:</label>
            <select id="logStatus">
              <option value="">All</option>
              <option value="Success">Success</option>
              <option value="Failed">Failed</option>
              <option value="Pending">Pending</option>
            </select>
          </div>
          <div style="padding-top:22px;">
            <button id="btnFilterLogs" class="btn-info">ğŸ” Filter</button>
          </div>
        </div>

        <div id="logSummary" class="stats-box">
          <div>Total: <span id="logTotal">0</span></div>
          <div>Success: <span id="logSuccess" style="color:#27ae60;">0</span></div>
          <div>Failed: <span id="logFailed" style="color:#e74c3c;">0</span></div>
        </div>

        <div id="logTable" style="max-height:200px; overflow-y:auto; border:1px solid #e8ecf4; border-radius:6px;">
          <table style="width:100%; border-collapse:collapse; font-size:11px;">
            <thead style="background:#f5f5f5; position:sticky; top:0;">
              <tr>
                <th style="padding:8px; text-align:left; border-bottom:1px solid #ddd;">Date</th>
                <th style="padding:8px; text-align:left; border-bottom:1px solid #ddd;">Company</th>
                <th style="padding:8px; text-align:left; border-bottom:1px solid #ddd;">Customer</th>
                <th style="padding:8px; text-align:left; border-bottom:1px solid #ddd;">Email</th>
                <th style="padding:8px; text-align:left; border-bottom:1px solid #ddd;">Status</th>
              </tr>
            </thead>
            <tbody id="logTableBody"></tbody>
          </table>
        </div>
      </fieldset>

      <fieldset>
        <legend>ğŸ“¥ Export</legend>
        <div class="row">
          <button id="btnExportToday" class="btn-success">ğŸ“¥ Export Today</button>
          <button id="btnExportFiltered" class="btn-primary">ğŸ“¥ Export Filtered</button>
          <button id="btnClearOldLogs" class="btn-warning">ğŸ—‘ï¸ Clear Old Logs (>7 days)</button>
        </div>
      </fieldset>
    </div>

  </div>

  <script src="lib/xlsx.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="popup.js" type="module"></script>
</body>
</html>
